<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monitoraggio Siti Web</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    table { border-collapse: collapse; width: 100%; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eee; }
    .online { color: green; font-weight: bold; }
    .offline { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Monitoraggio Siti Web</h1>
  <p>Elenco domini e stato di raggiungibilità:</p>
  <table>
    <thead>
      <tr><th>Dominio</th><th>Stato</th></tr>
    </thead>
    <tbody id="result-table">
      <tr><td colspan="2">Caricamento...</td></tr>
    </tbody>
  </table>

  <script>
    const API_URL = "https://www.zahntechnik.ch/check-sites.php";

    async function checkSiteStatus(domain) {
      const url = `https://${domain}/nf-check.html`;
      try {
        const res = await fetch(url, { method: 'HEAD', mode: 'no-cors' });
        // ATTENZIONE: in modalità no-cors non possiamo leggere lo status della risposta
        return 'online';
      } catch (err) {
        return 'offline';
      }
    }

    async function loadAndCheckSites() {
      try {
        const response = await fetch(API_URL);
        const domains = await response.json();

        const table = document.getElementById("result-table");
        table.innerHTML = "";

        for (const domain of domains) {
          const tr = document.createElement("tr");
          const tdDomain = document.createElement("td");
          const tdStatus = document.createElement("td");

          tdDomain.textContent = domain;
          tdStatus.textContent = "Verifica...";
          tdStatus.classList.add("checking");

          tr.appendChild(tdDomain);
          tr.appendChild(tdStatus);
          table.appendChild(tr);

          checkSiteStatus(domain).then(status => {
            tdStatus.textContent = status;
            tdStatus.className = status; // aggiunge classe online/offline
          });
        }
      } catch (err) {
        console.error("Errore durante il caricamento dei domini:", err);
        document.getElementById("result-table").innerHTML = "<tr><td colspan='2'>Errore nel caricamento dei dati.</td></tr>";
      }
    }

    loadAndCheckSites();
  </script>
</body>
</html>
